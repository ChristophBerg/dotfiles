#!/bin/sh

DIST=$(dpkg-parsechangelog | awk '/^Distribution:/ { print $2 }')

case $DIST in
	*backports*)
		PKG=$(dpkg-parsechangelog | awk '/^Source:/ { print $2 }')
		echo "Asking rmadison for last $DIST version ..."
		MADISON="$(rmadison -u bpo -s $DIST $PKG)"
		#echo "$MADISON"
		OLDVERSION=$(echo $MADISON | cut -d '|' -f 2 | sed -e 's/ //g')
		ARG_V="-v$OLDVERSION"
		VERSION=$(dpkg-parsechangelog | awk '/^Version:/ { print $2 }')
		case $VERSION in
			*-1~bpo*+1) ARG_SA="-sa" ;;
		esac
		echo Adding dpkg-buildpackage arguments $ARG_V $ARG_SA
		;;
esac

/usr/bin/dpkg-buildpackage $ARG_V $ARG_SA "$@"
