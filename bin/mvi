#!/usr/bin/perl -w
# $Id$
# rename multiple files
# Christoph Berg <cb@cs.uni-sb.de>
# 010711 cb

$tmp="/tmp/mvi-$$";

unless(@ARGV) {
	print STDERR "usage: $0 file...\n";
	exit 1;
}

$len = 0;
for (@ARGV) {
	$len = length($_) if length($_) > $len;
}
$len = 30 if $len > 30;

open TMP, ">$tmp" or die "$tmp: $!";

print TMP "#!/bin/sh\n";
print TMP "# edit this file to rename the files\n";
print TMP "\n";

for (@ARGV) {
	s/(.*)/'$1'/ if /[ ?*\[\]]/;
	printf TMP "mv %-${len}s $_\n", $_;
}
close TMP;

$age = (stat $tmp)[9];

$ENV{'EDITOR'} ||= 'vi';

system "$ENV{'EDITOR'} $tmp";

$age2 = (stat $tmp)[9];
if($age2 > $age) {
	system "sh -v $tmp";
} else {
	print STDERR "$0: file unchanged, aborting\n";
}

unlink $tmp;
-e "$tmp~" && unlink "$tmp~"; # delete backup
