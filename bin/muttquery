#!/usr/bin/perl
# $Id$

# format: email name comments

unless ($query = $ARGV[0]) {
	print "no query given?!\n";
	exit 1;
}

print "Looking for $query..\n";

# personal mutt aliases
if (open A, "$ENV{HOME}/.mutt/aliases") {
	while (<A>) {
		next if /^#/;
		next unless /$query/i;
		next unless /^alias (.*?)\s+(.*)\s+<(.*)>/;
		print "$3\t$2\t$1\n";
	}
	close A;
}

# pgp keys
if (open P, "pgpk -l $query |") {
	while (<P>) {
		next unless /^uid  (.*) <(.*)>(.*)/;
		print "$2\t$1\t$3\n";
	}
	close P;
}

# system passwd
while (($name, $comment, $gecos) = (getpwent)[0,5,6]) {
	$gecos =~ s/,| (\()/\t$1/;
	print "$name\t$gecos\t$comment\n" if $name =~ /$query/i
		or $comment =~ /$query/i or $gecos =~ /$query/i;
}

# sendmail aliases
if (open A, "/etc/aliases" or open "/etc/mail/aliases") {
	while (<A>) {
		next if /^#/;
		next unless /$query/i;
		next unless /^(.*?):\s+(.*)/;
		print "$1\t \t$2\n";
	}
	close A;
}
