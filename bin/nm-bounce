#!/bin/sh

# script for easier injection of messages into the NM db
# (please set pipe_split; unset pipe_decode in mutt)

TMP=`mktemp -t nm.XXXXXX`
cat > $TMP

TAG=`perl -lne 'if (/^Subject: .*?([\w.-]+\@[\w.-]+)/i) { $a = $1; $a =~ s/@/=/; print $a; exit 0; }' < $TMP`

[ "$TAG" ] && < $TMP formail -I"Delivered-To:" | /usr/sbin/sendmail nm-"$TAG"@nm.debian.org
rm -f $TMP
