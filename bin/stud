#!/usr/bin/perl -w
# cb 021008
# $Id$

use Getopt::Std;

getopts('e:');

# $test = 'http://www.rz.uni-saarland.de/cgi-bin/WebPh?DB=ns&ns_server=ph.rz.uni-sb.de&name=christoph+berg&email=&office_phone=&department=All+Departments+at+University+of+Saarland&type=';

$url1 = 'http://www.rz.uni-saarland.de/cgi-bin/WebPh?DB=ns&ns_server=ph.rz.uni-sb.de&name=';
$url2 = '&email=';
$url3 = '&office_phone=&department=All+Departments+at+University+of+Saarland&type=';

$email = $name = '';
if ($opt_e) {
	$opt_e = "$opt_e\@stud.uni-saarland.de" unless $opt_e =~ /@/;
	$email = $opt_e;
} else {
	$name = join "+", @ARGV;
}

$url = "$url1$name$url2$email$url3";

#print "getting $wget...\n";
open W, "wget -q -O - \"$url\"|" or die "wget: $!";

$c = 0;
while (<W>) {
	chomp;
	s/<\/tr>/\n/g;
	s/<.*?>//g;
	last if /based on +WebPh/;
	next if /Suchergebnis/;
	next if /There was 1 match to your request/;
	s/&nbsp;/ /g;
	s/^ +//; s/ +$//;
	if (/name:/) {
		print "---\n" if $c>0;
		$c++;
	}
	next if /^(status|Student):?$/;
	print "$_" unless $_ =~ /^\s+$/;
	print "\n" if /There|No matches/;
}
print "---\n" if $c > 0;
